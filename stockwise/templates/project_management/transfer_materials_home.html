{% extends 'base.html' %}

{% block title %}Transfer Materials{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto bg-surface/80 border border-primary rounded-xl p-8 shadow-md">
  <h1 class="text-3xl font-bold mb-8 text-primary">Transfer Materials</h1>

  <!-- Filter Row -->
  <div class="flex items-center gap-4 mb-8 flex-wrap">
    <label for="projectFilter" class="text-secondary font-semibold whitespace-nowrap">
      Filter by Project:
    </label>
    <select
      id="projectFilter"
      class="min-w-[200px] px-3 py-2 rounded border border-muted bg-surface text-secondary focus:outline-none focus:ring-2 focus:ring-primary"
    >
      <option value="all">All Projects</option>
      {% for entry in project_materials %}
        <option value="project-{{ entry.project.project_id }}">{{ entry.project.project_name }}</option>
      {% endfor %}
    </select>
  </div>

  <!-- Grid of Project Cards -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {% for entry in project_materials %}
      <section class="project-card project-{{ entry.project.project_id }} bg-surface/60 border border-primary/40 rounded-lg p-6 shadow-sm w-full">
        <h2 class="text-xl font-semibold mb-4 text-primary">Project: {{ entry.project.project_name }}</h2>

        {% if entry.materials %}
          <div class="overflow-x-auto">
            <table class="w-full text-sm border border-muted rounded-lg">
              <thead class="bg-muted/20 text-left">
                <tr>
                  <th class="px-3 py-2 border-b border-muted">Material</th>
                  <th class="px-3 py-2 border-b border-muted">Quantity</th>
                  <th class="px-3 py-2 border-b border-muted">Action</th>
                </tr>
              </thead>
              <tbody>
                {% for im in entry.materials %}
                  {% if im.quantity > 0 %}
                    <tr class="hover:bg-primary/20 transition">
                      <td class="px-3 py-2 border-b border-muted break-words">{{ im.material.material_name }}</td>
                      <td class="px-3 py-2 border-b border-muted">{{ im.quantity }} {{ im.material.unit }}</td>
                      <td class="px-3 py-2 border-b border-muted">
                        <a href="{% url 'project_management:transfer_material_form' entry.project.project_id im.material.material_id %}"
                           class="text-primary font-semibold hover:underline hover:text-yellow-400 whitespace-nowrap">
                          Transfer
                        </a>
                      </td>
                    </tr>
                  {% endif %}
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p class="text-muted italic">No materials found for this project.</p>
        {% endif %}
      </section>
    {% endfor %}
  </div>
</div>

<!-- JavaScript for filtering -->
<script>
  const filterSelect = document.getElementById('projectFilter');
  const cards = document.querySelectorAll('.project-card');

  filterSelect.addEventListener('change', () => {
    const selected = filterSelect.value;

    cards.forEach(card => {
      if (selected === 'all') {
        card.classList.remove('hidden');
      } else {
        card.classList.toggle('hidden', !card.classList.contains(selected));
      }
    });
  });
</script>
{% endblock %}
