{% extends "base.html" %}

{% block content %}
<div class="container mx-auto px-4 py-6">
  <h1 class="text-2xl font-semibold mb-6 text-gray-800">Purchase Orders List</h1>

  <table class="min-w-full border border-gray-300 rounded-lg shadow-sm overflow-hidden">
    <thead class="bg-gray-100 border-b border-gray-300">
      <tr>
        <th class="text-left px-4 py-3 font-semibold text-gray-700">PO ID</th>
        <th class="text-left px-4 py-3 font-semibold text-gray-700">Delivery Date</th>
        <th class="text-left px-4 py-3 font-semibold text-gray-700">Status</th>
        <th class="text-left px-4 py-3 font-semibold text-gray-700">Material</th>
        <th class="text-left px-4 py-3 font-semibold text-gray-700">Total Quantity</th>
        <th class="text-center px-4 py-3 font-semibold text-gray-700">Actions</th>
      </tr>
    </thead>
    <tbody class="bg-white divide-y divide-gray-200">
      {% for po in purchase_orders %}
        <tr>
          <td class="px-4 py-3 whitespace-nowrap text-gray-900 font-medium">{{ po.po_id }}</td>
          <td class="px-4 py-3 whitespace-nowrap text-gray-700">{{ po.delivery_date|date:"Y-m-d" }}</td>
          <td class="px-4 py-3 whitespace-nowrap">
            {% if po.po_status == 'Completed' %}
              <span class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">{{ po.po_status }}</span>
            {% else %}
              <span class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800">{{ po.po_status }}</span>
            {% endif %}
          </td>
          <td class="px-4 py-3 whitespace-nowrap text-gray-700">
            {% if po.offerpurchaseorder and po.offerpurchaseorder.offer and po.offerpurchaseorder.offer.offerrequestdetail %}
              {{ po.offerpurchaseorder.offer.offerrequestdetail.request_detail.material.material_name }}
            {% else %}
              <span class="text-gray-400 italic">N/A</span>
            {% endif %}
          </td>
          <td class="px-4 py-3 whitespace-nowrap text-gray-700">
            {% if po.offerpurchaseorder and po.offerpurchaseorder.offer %}
              {{ po.offerpurchaseorder.offer.total_quantity }}
            {% else %}
              <span class="text-gray-400 italic">N/A</span>
            {% endif %}
          </td>
          <td class="px-4 py-3 whitespace-nowrap text-center">
            {% if po.po_status != 'Completed' %}
              <form method="post" class="inline-block">
                {% csrf_token %}
                <input type="hidden" name="po_id" value="{{ po.po_id }}">
                <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-1 px-4 rounded shadow">
                  Complete Order
                </button>
              </form>
            {% else %}
              <span class="text-gray-500 italic">Completed</span>
            {% endif %}
          </td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="6" class="text-center py-6 text-gray-500 italic">No purchase orders found.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
